PROTO_0:
  FASTCALL1 TYPE R0 [+3]
  MOVE R2 R0
  GETIMPORT R1 K1 [type]
  CALL R1 1 1
  JUMPIFEQKS R1 K2 ["table"] [+3]
  LOADN R1 0
  RETURN R1 1
  LOADN R1 0
  GETIMPORT R2 K4 [pairs]
  MOVE R3 R0
  CALL R2 1 3
  FORGPREP_NEXT R2
  ADDK R1 R1 K5 [1]
  FORGLOOP R2 1 [-2]
  RETURN R1 1

PROTO_1:
  ORK R2 R2 K0 [0]
  LOADK R3 K1 ["	"]
  MOVE R5 R2
  NAMECALL R3 R3 K2 ["rep"]
  CALL R3 2 1
  FASTCALL1 TOSTRING R0 [+3]
  MOVE R5 R0
  GETIMPORT R4 K4 [tostring]
  CALL R4 1 1
  FASTCALL1 TOSTRING R1 [+3]
  MOVE R6 R1
  GETIMPORT R5 K4 [tostring]
  CALL R5 1 1
  FASTCALL1 TYPE R0 [+3]
  MOVE R7 R0
  GETIMPORT R6 K6 [type]
  CALL R6 1 1
  JUMPIFEQKS R6 K7 ["string"] [+7]
  LOADK R6 K8 ["[%s]"]
  MOVE R8 R4
  NAMECALL R6 R6 K9 ["format"]
  CALL R6 2 1
  MOVE R4 R6
  FASTCALL1 TYPE R1 [+3]
  MOVE R7 R1
  GETIMPORT R6 K6 [type]
  CALL R6 1 1
  JUMPIFNOTEQKS R6 K7 ["string"] [+8]
  LOADK R6 K10 ["\"%s\""]
  MOVE R8 R5
  NAMECALL R6 R6 K9 ["format"]
  CALL R6 2 1
  MOVE R5 R6
  JUMP [+73]
  FASTCALL1 TYPE R1 [+3]
  MOVE R7 R1
  GETIMPORT R6 K6 [type]
  CALL R6 1 1
  JUMPIFNOTEQKS R6 K11 ["table"] [+67]
  FASTCALL1 TYPE R1 [+3]
  MOVE R8 R1
  GETIMPORT R7 K6 [type]
  CALL R7 1 1
  JUMPIFEQKS R7 K11 ["table"] [+3]
  LOADN R6 0
  JUMP [+10]
  LOADN R7 0
  GETIMPORT R8 K13 [pairs]
  MOVE R9 R1
  CALL R8 1 3
  FORGPREP_NEXT R8
  ADDK R7 R7 K14 [1]
  FORGLOOP R8 1 [-2]
  MOVE R6 R7
  LOADN R7 15
  JUMPIFLT R7 R6 [+4]
  GETUPVAL R8 0
  GETTABLE R7 R8 R0
  JUMPIFNOT R7 [+8]
  LOADK R7 K15 ["%s (length = %d)"]
  MOVE R9 R5
  MOVE R10 R6
  NAMECALL R7 R7 K9 ["format"]
  CALL R7 3 1
  MOVE R5 R7
  JUMP [+33]
  LOADK R5 K16 ["{"]
  GETIMPORT R7 K13 [pairs]
  MOVE R8 R1
  CALL R7 1 3
  FORGPREP_NEXT R7
  MOVE R12 R5
  LOADK R13 K17 ["
%s"]
  GETUPVAL R15 1
  MOVE R16 R10
  MOVE R17 R11
  ADDK R18 R2 K14 [1]
  CALL R15 3 -1
  NAMECALL R13 R13 K9 ["format"]
  CALL R13 -1 1
  CONCAT R5 R12 R13
  FORGLOOP R7 2 [-12]
  MOVE R7 R5
  LOADN R10 0
  JUMPIFNOTLT R10 R6 [+8]
  LOADK R10 K17 ["
%s"]
  MOVE R12 R3
  NAMECALL R10 R10 K9 ["format"]
  CALL R10 2 1
  MOVE R8 R10
  JUMPIF R8 [+1]
  LOADK R8 K18 [" "]
  LOADK R9 K19 ["}"]
  CONCAT R5 R7 R9
  LOADK R6 K20 ["%s%s	 = %s"]
  MOVE R8 R3
  MOVE R9 R4
  MOVE R10 R5
  NAMECALL R6 R6 K9 ["format"]
  CALL R6 4 1
  RETURN R6 1

PROTO_2:
  GETTABLEKS R4 R2 K0 ["type"]
  JUMPIFNOT R4 [+7]
  GETTABLEKS R4 R2 K0 ["type"]
  FASTCALL1 TOSTRING R4 [+2]
  GETIMPORT R3 K2 [tostring]
  CALL R3 1 1
  JUMPIF R3 [+1]
  LOADK R3 K3 ["(action.type == nil)"]
  LOADK R4 K4 ["-"]
  LOADN R6 40
  NAMECALL R4 R4 K5 ["rep"]
  CALL R4 2 1
  GETIMPORT R5 K7 [print]
  MOVE R6 R4
  CALL R5 1 0
  GETIMPORT R5 K7 [print]
  LOADK R6 K8 ["Handling action %s"]
  MOVE R8 R3
  NAMECALL R6 R6 K9 ["format"]
  CALL R6 2 -1
  CALL R5 -1 0
  GETTABLEKS R5 R2 K0 ["type"]
  JUMPIFNOTEQKS R5 K10 ["@@INIT"] [+9]
  GETIMPORT R5 K7 [print]
  GETUPVAL R6 0
  LOADK R7 K11 ["State"]
  MOVE R8 R1
  LOADN R9 1
  CALL R6 3 1
  CALL R5 1 0
  GETIMPORT R5 K7 [print]
  GETUPVAL R6 0
  LOADK R7 K12 ["Action %s"]
  MOVE R9 R3
  NAMECALL R7 R7 K9 ["format"]
  CALL R7 2 1
  MOVE R8 R2
  LOADN R9 1
  CALL R6 3 1
  CALL R5 1 0
  MOVE R5 R0
  MOVE R6 R1
  MOVE R7 R2
  CALL R5 2 1
  GETIMPORT R6 K7 [print]
  GETUPVAL R7 0
  LOADK R8 K13 ["New state"]
  MOVE R9 R5
  LOADN R10 1
  CALL R7 3 1
  CALL R6 1 0
  GETIMPORT R6 K7 [print]
  MOVE R7 R4
  CALL R6 1 0
  RETURN R5 1

MAIN:
  PREPVARARGS 0
  DUPCLOSURE R0 K0 [PROTO_0]
  DUPTABLE R1 K3 [{"categories", "sorts"}]
  LOADB R2 1
  SETTABLEKS R2 R1 K1 ["categories"]
  LOADB R2 1
  SETTABLEKS R2 R1 K2 ["sorts"]
  DUPCLOSURE R2 K4 [PROTO_1]
  CAPTURE VAL R1
  CAPTURE VAL R2
  DUPCLOSURE R3 K5 [PROTO_2]
  CAPTURE VAL R2
  RETURN R3 1
